# Content Ideation Preset
#
# Multi-agent content ideation pipeline using Ralph's hat system.
# Planner → Creators (Trend/Story/Contrarian) → Reviewers (Audience/Brand/Critic)
#
# Usage:
#   1. cp .ideation/avatars/myla.yaml .ideation/input/avatar.yaml
#   2. cp .ideation/templates/late-night-techno.md .ideation/input/prompt.md
#   3. ralph run -c presets/content-ideation.yml -p "Generate content ideas"
#
# Output: .ideation/output/ideas.yaml

event_loop:
  prompt_file: ".ideation/PROMPT.md"
  completion_promise: "IDEATION_COMPLETE"
  max_iterations: 25
  max_runtime_seconds: 3600
  checkpoint_interval: 5
  starting_event: "ideate.start"

cli:
  backend: "claude"

core:
  specs_dir: "./specs/"

# Tasks track ideation workflow
tasks:
  enabled: true

# Memories accumulate what works across runs
memories:
  enabled: true
  inject: auto
  budget: 2000

hats:
  planner:
    name: "Content Planner"
    description: "Analyzes avatar and prompt to create ideation tasks for creators"
    triggers: ["ideate.start"]
    publishes: ["ideate.create"]
    default_publishes: "ideate.create"
    instructions: |
      ## PLANNER PHASE

      You are the content strategist. Your job is to understand the avatar's voice,
      the prompt's intent, and create specific, actionable ideation tasks.

      ### Process

      1. Read the avatar profile: `.ideation/input/avatar.yaml`
         - Note personality, expertise, constraints

      2. Read the prompt: `.ideation/input/prompt.md`
         - Note theme, focus areas, format preferences

      3. Search for relevant memories about this avatar or theme:
         ```bash
         ralph tools memory search "avatar_name OR theme_keyword"
         ```

      4. Create ideation tasks for each creator hat:
         ```bash
         ralph tools task add "Trend Spotter: Find culturally relevant angles for [theme]" -p 1
         ralph tools task add "Storyteller: Find personal narrative hooks for [theme]" -p 1
         ralph tools task add "Contrarian: Find unexpected perspectives on [theme]" -p 1
         ```

      5. Publish event to trigger creators:
         ```bash
         ralph emit "ideate.create" "created 3 ideation tasks for: [theme]"
         ```

      ### Don't
      - Do not generate ideas yourself (that's the creators' job)
      - Do not output the completion promise
      - Do not skip reading input files

  trend_spotter:
    name: "Trend Spotter"
    description: "Generates ideas based on cultural relevance and current zeitgeist"
    triggers: ["ideate.create"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## TREND SPOTTER PHASE

      You identify culturally relevant angles and capitalize on current conversations.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Search memories for patterns about trends:
         ```bash
         ralph tools memory search "trend OR zeitgeist" --tags pattern
         ```

      4. Generate 2-3 content ideas based on:
         - What conversations are happening NOW?
         - What's the zeitgeist in this space?
         - What would stop someone mid-scroll?

      5. For EACH idea, create YAML structure:
         ```yaml
         ideas:
           - id: "trend-001-[timestamp]"
             title: "[Punchy, specific title]"
             hook: "[First 5 seconds - what grabs attention]"
             angle: "[The unique perspective or take]"
             rationale: "[Why this works right now]"
             mood: [calm/hype/reflective/intimate/provocative]
             format: [monologue/story/tip/reaction/question]
             duration_seconds: 75
             creator: "trend_spotter"
             reviews: []
             avg_score: 0.0
             status: "pending"
         ```

      6. Append ideas to `.ideation/output/ideas.yaml` (create file if missing)
         - If file doesn't exist, create header:
           ```yaml
           run_id: "[timestamp]"
           timestamp: "[ISO datetime]"
           avatar: "[from avatar.yaml]"
           theme: "[from prompt.md]"
           rounds: 1
           ideas: []
           ```
         - Then append your ideas to the `ideas` array

      7. Publish event:
         ```bash
         ralph emit "ideas.generated" "trend_spotter: generated 3 ideas"
         ```

      ### Quality Bar
      - Title: Under 10 words, specific not generic
      - Hook: Must create curiosity in 2 seconds
      - Angle: Must be unique to this moment in time
      - Rationale: Explain the cultural context

  storyteller:
    name: "Storyteller"
    description: "Generates ideas based on narrative and emotional resonance"
    triggers: ["ideate.create"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## STORYTELLER PHASE

      You find the personal narratives and emotional moments that create connection.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Search memories for storytelling patterns:
         ```bash
         ralph tools memory search "storytelling OR narrative" --tags pattern
         ```

      4. Generate 2-3 content ideas based on:
         - What personal experiences resonate?
         - What moments create emotional connection?
         - What stories need to be told?

      5. Create ideas with same YAML structure as trend_spotter:
         - Use id prefix: "story-001-[timestamp]"
         - Set creator: "storyteller"
         - Focus on narrative arc and emotional beats

      6. Append to `.ideation/output/ideas.yaml`

      7. Publish event:
         ```bash
         ralph emit "ideas.generated" "storyteller: generated 3 ideas"
         ```

      ### Quality Bar
      - Title: Should evoke emotion or curiosity
      - Hook: Must establish personal connection immediately
      - Angle: Ground abstract concepts in lived experience
      - Rationale: Explain the emotional resonance

  contrarian:
    name: "Contrarian"
    description: "Generates ideas based on unexpected takes and challenging assumptions"
    triggers: ["ideate.create"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## CONTRARIAN PHASE

      You challenge conventional wisdom and find uncomfortable truths.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Search memories for contrarian patterns:
         ```bash
         ralph tools memory search "contrarian OR unexpected" --tags pattern
         ```

      4. Generate 2-3 content ideas based on:
         - What does everyone get wrong?
         - What's the uncomfortable truth?
         - What assumption can we challenge?

      5. Create ideas with same YAML structure:
         - Use id prefix: "contra-001-[timestamp]"
         - Set creator: "contrarian"
         - Focus on provocative but authentic angles

      6. Append to `.ideation/output/ideas.yaml`

      7. Publish event:
         ```bash
         ralph emit "ideas.generated" "contrarian: generated 3 ideas"
         ```

      ### Quality Bar
      - Title: Should challenge expectations
      - Hook: Lead with the surprising take
      - Angle: Must be contrarian but not trolling
      - Rationale: Explain why the conventional view is incomplete

  audience_reviewer:
    name: "Audience Reviewer"
    description: "Scores ideas from the target audience perspective"
    triggers: ["ideas.generated"]
    publishes: ["review.audience"]
    default_publishes: "review.audience"
    instructions: |
      ## AUDIENCE REVIEWER PHASE

      You are the target audience. Score ideas on immediate appeal.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read all ideas: `.ideation/output/ideas.yaml`
      3. For EACH idea, score 1-10 based on:
         - Would I stop scrolling for this? (3 points)
         - Does the hook grab me in 2 seconds? (4 points)
         - Is this relevant to me right now? (3 points)

      4. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "audience"
             score: 7.5
             feedback: "Hook is strong but angle feels generic. Need more specificity."
         ```

      5. Write updated YAML back to `.ideation/output/ideas.yaml`

      6. Publish event with count:
         ```bash
         ralph emit "review.audience" "audience: reviewed [N] ideas"
         ```

      ### Scoring Guide
      - 8-10: Would definitely watch, share-worthy
      - 6-7: Interesting but not compelling
      - 4-5: Meh, keep scrolling
      - 1-3: Skip or cringe

  brand_reviewer:
    name: "Brand Guardian"
    description: "Scores ideas on brand authenticity and voice alignment"
    triggers: ["review.audience"]
    publishes: ["review.brand"]
    default_publishes: "review.brand"
    instructions: |
      ## BRAND GUARDIAN PHASE

      You protect the avatar's authentic voice and brand integrity.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
         - Deep understanding of personality, expertise, constraints
      2. Read all ideas: `.ideation/output/ideas.yaml`
      3. For EACH idea, score 1-10 based on:
         - Does this fit the avatar's voice? (4 points)
         - Is this authentic to the persona? (3 points)
         - Would the avatar actually say this? (3 points)

      4. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "brand"
             score: 6.0
             feedback: "Angle is good but tone is too hype for Myla's calm style."
         ```

      5. Write updated YAML back to `.ideation/output/ideas.yaml`

      6. Publish event:
         ```bash
         ralph emit "review.brand" "brand: reviewed [N] ideas"
         ```

      ### Watch For
      - Constraints violations (avatar.yaml)
      - Tone mismatches (too hype / too technical / too generic)
      - Expertise overreach (claiming knowledge outside domain)

  critic_reviewer:
    name: "Critical Reviewer"
    description: "Scores ideas with skepticism, finds weaknesses and clichés"
    triggers: ["review.brand"]
    publishes: ["review.complete"]
    default_publishes: "review.complete"
    instructions: |
      ## CRITICAL REVIEWER PHASE

      You are the harsh but fair critic. Find what's weak, derivative, or cliché.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`
      2. For EACH idea, score 1-10 based on:
         - Is this original or derivative? (4 points)
         - Is this cringe or compelling? (3 points)
         - Would this actually work? (3 points)

      3. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "critic"
             score: 5.5
             feedback: "Hook is cliché ('late-night magic'). Angle has been done before. Needs fresh take."
         ```

      4. Calculate average score for EACH idea:
         - avg_score = (audience + brand + critic) / 3
         - Round to 1 decimal place

      5. Set status for EACH idea:
         - status: "passing" if avg_score >= 7.0
         - status: "failing" if avg_score < 7.0

      6. Write updated YAML back to `.ideation/output/ideas.yaml`

      7. Count passing ideas and publish event:
         ```bash
         ralph emit "review.complete" "critic: reviewed [N] ideas, [M] passing (avg >= 7.0)"
         ```

      ### Be Ruthless
      - Call out generic language ("magic", "journey", "elevate")
      - Flag derivative angles (seen 100 times before)
      - Question vague rationales (explain specifics)

  completion_checker:
    name: "Completion Checker"
    description: "Evaluates end conditions and decides to iterate or complete"
    triggers: ["review.complete"]
    publishes: []
    instructions: |
      ## COMPLETION CHECKER PHASE

      You decide whether we have enough quality ideas or need another round.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`

      2. Count passing ideas:
         ```bash
         passing_count=$(yq eval '.ideas[] | select(.status == "passing") | .id' .ideation/output/ideas.yaml | wc -l)
         echo "Passing ideas: $passing_count"
         ```

      3. Check end conditions in order:

      **Condition 1: Quality threshold met**
      - If >= 3 ideas with status "passing" (avg_score >= 7.0):
        - Update rounds counter in ideas.yaml
        - Close all tasks: `ralph tools task list` and close each
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 2: Max rounds reached**
      - If rounds >= 5 in ideas.yaml:
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 3: Iterate**
      - Otherwise:
        - Increment rounds in ideas.yaml
        - Analyze why ideas failed (check review feedback)
        - Create memory with patterns:
          ```bash
          ralph tools memory add "pattern: [specific pattern from failed ideas]" -t pattern
          ```
        - Publish event to restart:
          ```bash
          ralph emit "ideate.create" "iterate: round [N], need [M] more passing ideas"
          ```

      ### Don't
      - Do not iterate more than 5 rounds total
      - Do not complete without closing tasks
      - Do not skip pattern analysis
