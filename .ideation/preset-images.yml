# Content Ideation with Images Preset
#
# Image-driven ideation pipeline where each idea is connected to visual assets.
# Planner → Image Analyzer → Creators (Trend/Story) → Reviewers (Audience+Brand/Critic)
#
# Usage:
#   1. cp .ideation/templates/avatar/myla.yaml .ideation/input/avatar.yaml
#   2. cp .ideation/templates/late-night-techno.md .ideation/input/prompt.md
#   3. ideate run-with-images ./path/to/images "Generate content ideas"
#
# Output: .ideation/output/ideas.yaml (with image_files field)

event_loop:
  prompt_file: ".ideation/PROMPT.md"
  completion_promise: "IDEATION_COMPLETE"
  max_iterations: 25
  max_runtime_seconds: 3600
  checkpoint_interval: 5
  starting_event: "ideate.start"

cli:
  backend: "claude"

core:
  specs_dir: "./specs/"

tasks:
  enabled: true

memories:
  enabled: true
  inject: auto
  budget: 2000

hats:
  planner:
    name: "Content Planner"
    description: "Analyzes avatar, prompt, and images to create video script ideation tasks"
    triggers: ["ideate.start"]
    publishes: ["ideate.analyze_images"]
    default_publishes: "ideate.analyze_images"
    instructions: |
      ## PLANNER PHASE

      CRITICAL: We are creating VIDEO SCRIPTS. Images will be used to GENERATE videos.
      This is NOT about photo captions or describing images.

      You are the content strategist. Your job is to understand the avatar's voice,
      the prompt's intent, the available images as video assets, and create specific
      video script ideation tasks.

      ### Process

      1. Read the avatar profile: `.ideation/input/avatar.yaml`
         - Note personality, expertise, constraints

      2. Read the prompt: `.ideation/input/prompt.md`
         - Note theme, focus areas, format preferences

      3. Read the images index: `.ideation/input/images-index.md`
         - These are VIDEO ASSETS that will be used to generate video content
         - Think: "What video scripts could work with these visuals?"

      4. Search for relevant memories about this avatar or theme:
         ```bash
         ralph tools memory search "avatar_name OR theme_keyword"
         ```

      5. Create task for image analysis:
         ```bash
         ralph tools task add "Image Analyzer: Analyze images as video assets, identify script themes" -p 1
         ```

      6. Publish event to trigger image analysis:
         ```bash
         ralph emit "ideate.analyze_images" "created video asset analysis task"
         ```

      ### Don't
      - Do not generate ideas yourself (that's the creators' job)
      - Do not output the completion promise
      - Do not skip reading input files
      - Do not think of images as photos to caption - they're VIDEO CONTENT

  image_analyzer:
    name: "Image Analyzer"
    description: "Analyzes images that will be used to generate videos"
    triggers: ["ideate.analyze_images"]
    publishes: ["images.analyzed"]
    default_publishes: "images.analyzed"
    instructions: |
      ## IMAGE ANALYZER PHASE

      CRITICAL: These images will be used to GENERATE VIDEOS. You are analyzing visual assets
      that will become video content, not photos to describe or caption.

      You analyze the provided images and identify what video content they can support.

      ### Process

      1. Read images index: `.ideation/input/images-index.md`
      2. Read avatar: `.ideation/input/avatar.yaml`
      3. Read prompt: `.ideation/input/prompt.md`

      4. For EACH image in the index:
         - Read the image file (use the full path from the index)
         - Analyze visual content, mood, composition, colors, subjects
         - Think: "What VIDEO SCRIPT would work with this visual?"
         - Identify what video narratives this image could support as visual content

      5. Create image analysis file: `.ideation/output/image-analysis.yaml`
         ```yaml
         images:
           - file: "path/to/image1.jpg"
             description: "Detailed description of what's in the image"
             mood: [intimate/energetic/reflective/moody/vibrant]
             video_script_themes:
               - "VIDEO SCRIPT idea: What the creator could talk about while this image plays"
               - "VIDEO SCRIPT idea: Another narrative that works with this visual"
             potential_formats: [monologue/story/tip/reaction]
             duration_fit: "60-90 seconds for this pace"
             note: "This image will be used to generate the video - think about what story/script fits the visual"

           - file: "path/to/image2.jpg"
             description: "..."
             mood: [...]
             video_script_themes: [...]
             potential_formats: [...]
             duration_fit: "..."
             note: "..."
         ```

      6. Create ideation tasks for creators:
         ```bash
         ralph tools task add "Trend Spotter: Write VIDEO SCRIPTS that will be generated using the analyzed images" -p 1
         ralph tools task add "Storyteller: Write VIDEO SCRIPTS that will be generated using the analyzed images" -p 1
         ```

      7. Publish event:
         ```bash
         ralph emit "images.analyzed" "analyzed [N] images for video generation, identified [M] video script themes"
         ```

      ### Quality Bar
      - Be specific about visual elements (not just "a person dancing")
      - Think: "What would someone SAY in a video while this image plays?"
      - These are VIDEO ASSETS, not photo captions or image descriptions
      - Connect image mood to video narrative opportunities

  trend_spotter:
    name: "Trend Spotter"
    description: "Writes video scripts based on cultural relevance, using images as video content"
    triggers: ["images.analyzed"]
    publishes: ["trend.done"]
    default_publishes: "trend.done"
    instructions: |
      ## TREND SPOTTER PHASE

      CRITICAL: You are writing VIDEO SCRIPTS. The images will be used to GENERATE the video.
      Do NOT write about the photos. Write scripts for videos that will be created FROM the images.

      You identify culturally relevant angles and write video scripts that work with the visual content.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`
      4. Search memories for patterns about trends:
         ```bash
         ralph tools memory search "trend OR zeitgeist" --tags pattern
         ```

      5. Generate 2-3 VIDEO SCRIPT ideas where EACH idea:
         - Is a SCRIPT the avatar will speak in a video
         - Uses 1-3 images that will play during the video
         - The hook/content is what they SAY, not what the image shows
         - Is based on current cultural conversations

      6. For EACH idea, create YAML structure:
         ```yaml
         ideas:
           - id: "trend-001-[timestamp]"
             title: "[Title of the video script]"
             hook: "[First 5 seconds - what the creator SAYS to grab attention]"
             angle: "[The unique perspective in their narration]"
             rationale: "[Why this script/narrative works right now]"
             mood: [calm/hype/reflective/intimate/provocative]
             format: [monologue/story/tip/reaction/question]
             duration_seconds: 75
             creator: "trend_spotter"
             image_files:
               - "path/to/image1.jpg"
               - "path/to/image2.jpg"
             image_usage: "Image1 plays during opening hook (0-15s). Image2 plays during the main point (30-45s). The creator narrates OVER these visuals."
             reviews: []
             avg_score: 0.0
             status: "pending"
         ```

      7. Append ideas to `.ideation/output/ideas.yaml` (create file if missing)
         - If file doesn't exist, create header:
           ```yaml
           run_id: "[timestamp]"
           timestamp: "[ISO datetime]"
           avatar: "[from avatar.yaml]"
           theme: "[from prompt.md]"
           rounds: 1
           ideas: []
           ```
         - Then append your ideas to the `ideas` array

      8. Publish event:
         ```bash
         ralph emit "trend.done" "trend_spotter: generated [N] video scripts with image assets"
         ```

      ### Quality Bar
      - Title/hook/angle is what the creator SAYS, not what's in the photo
      - Images are the VIDEO VISUALS that play while they talk
      - Explain when each image appears during the narration
      - The script should work WITH the visuals, not describe them
      - Think: "What would I say in a video while this image plays on screen?"

  storyteller:
    name: "Storyteller"
    description: "Writes video story scripts with images as visual content"
    triggers: ["trend.done"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## STORYTELLER PHASE

      CRITICAL: You are writing VIDEO STORY SCRIPTS. The images will be used to GENERATE the video.
      Do NOT write about the photos. Write narrative scripts that will be spoken OVER the video visuals.

      You find personal narratives and write scripts where images play as the visual backdrop.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`
      4. Search memories for storytelling patterns:
         ```bash
         ralph tools memory search "storytelling OR narrative" --tags pattern
         ```

      5. Generate 2-3 VIDEO STORY SCRIPTS where EACH idea:
         - Is a NARRATIVE the avatar will speak in the video
         - Uses 1-3 images that will play during the story
         - The hook/story is what they SAY, not what the image shows
         - Tells a personal or emotional narrative

      6. Create ideas with YAML structure including image_files and image_usage:
         - Use id prefix: "story-001-[timestamp]"
         - Set creator: "storyteller"
         - Title/hook/angle is the SPOKEN NARRATIVE
         - Image_files are the VIDEO VISUALS
         - Image_usage explains when images appear during the narration
         - Focus on narrative arc and emotional beats in the SCRIPT

      7. Append to `.ideation/output/ideas.yaml`

      8. Publish event:
         ```bash
         ralph emit "ideas.generated" "storyteller: generated [N] video story scripts with image assets"
         ```

      ### Quality Bar
      - The story is what the creator NARRATES, not what's in the photos
      - Images play as visual content while they tell the story
      - Explain when each image appears during the narrative
      - Images amplify emotional moments in the SPOKEN story
      - Think: "I'm telling a story on camera - these images play as B-roll while I talk"

  audience_brand_reviewer:
    name: "Audience & Brand Reviewer"
    description: "Scores video scripts on audience appeal, brand authenticity, and video visual coherence"
    triggers: ["ideas.generated"]
    publishes: ["review.audience_brand"]
    default_publishes: "review.audience_brand"
    instructions: |
      ## AUDIENCE & BRAND REVIEWER PHASE

      CRITICAL: You are reviewing VIDEO SCRIPTS where images serve as video content.
      Evaluate the SCRIPT (what they say) and how well it works WITH the video visuals.

      You evaluate video scripts from three perspectives: audience appeal, brand authenticity,
      AND how well the script works with the video visuals.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read all ideas: `.ideation/output/ideas.yaml`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`

      4. For EACH video script idea, score 1-10 based on combined criteria:

         **Audience Appeal (3 points):**
         - Would this VIDEO SCRIPT stop me scrolling? (1.5 points)
         - Does the SPOKEN HOOK grab me in 2 seconds? (1.5 points)

         **Brand Authenticity (3 points):**
         - Does this NARRATION fit the avatar's voice? (1.5 points)
         - Would the avatar actually SAY this on camera? (1.5 points)

         **Video Visual Coherence (4 points):**
         - Do the video visuals enhance the SPOKEN narrative? (2 points)
         - Is the visual timing purposeful (not just "background")? (1 point)
         - Does the script work WITH the visuals (not describe them)? (1 point)

      5. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "audience_brand"
             score: 7.5
             feedback: "Strong spoken hook. Video visuals support the narrative at 0-15s but the script starts describing the image at 30s instead of telling the story. Avatar's tone fits well."
         ```

      6. Write updated YAML back to `.ideation/output/ideas.yaml`

      7. Publish event:
         ```bash
         ralph emit "review.audience_brand" "audience_brand: reviewed [N] video scripts"
         ```

      ### Scoring Guide
      - 9-10: Exceptional video script + visuals work perfectly together
      - 7-8: Strong script, visuals enhance the narration
      - 5-6: Decent but script describes images instead of telling story
      - 3-4: Script is about the photos, not a standalone narrative
      - 1-2: Poor script or brand violation

      ### Red Flags
      - Script says "look at this" or describes what's on screen
      - Images are just "background" without timing/purpose
      - Could be a photo caption instead of a video script

  critic_reviewer:
    name: "Critical Reviewer"
    description: "Scores video scripts with skepticism, evaluates originality and video execution"
    triggers: ["review.audience_brand"]
    publishes: ["review.complete"]
    default_publishes: "review.complete"
    instructions: |
      ## CRITICAL REVIEWER PHASE

      CRITICAL: You are reviewing VIDEO SCRIPTS. Be ruthless about scripts that just describe
      photos instead of telling stories. The script should work as narration OVER video visuals.

      You are the ruthless critic who evaluates video script quality and video execution.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`
      2. Read image analysis: `.ideation/output/image-analysis.yaml`

      3. For EACH video script, score 1-10 with extreme skepticism:
         - Is the SCRIPT truly original? (3 points)
         - Is the NARRATION cringe, derivative, or genuinely fresh? (2 points)
         - Would this VIDEO actually stop someone scrolling? (2 points)
         - Does the script WORK WITH visuals or just describe them? (2 points)
         - Does the video visual timing elevate the narrative? (1 point)

      4. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "critic"
             score: 5.0
             feedback: "Script uses tired pattern ('Everyone says X but Y'). Narration describes the images instead of telling a story over them. Visual timing is vague ('background footage'). This reads like a photo caption, not a video script. What makes THIS different from 1000 other posts?"
         ```

      5. Calculate average score for EACH idea:
         - avg_score = (audience_brand + critic) / 2
         - Round to 1 decimal place

      6. Set status for EACH idea:
         - status: "passing" if avg_score >= 8.0
         - status: "failing" if avg_score < 8.0

      7. Write updated YAML back to `.ideation/output/ideas.yaml`

      8. Publish event:
         ```bash
         ralph emit "review.complete" "critic: reviewed [N] video scripts, [M] passing"
         ```

      ### Be EXTREMELY Ruthless
      - INSTANT FAIL: Script describes what's in the photos ("as you can see here...")
      - INSTANT FAIL: Vague timing ("plays as background", "for visual interest")
      - Call out clichéd visuals (sunset silhouettes, coffee cups, generic hands)
      - Reward scripts that work AS NARRATION with timed visual beats
      - The script should make sense even without seeing the video
      - Default score: 5-6. Make them earn 8+.

      ### Quality Check Questions
      - Could this work as a TikTok/Reel voiceover? (Good sign)
      - Is this just a photo caption stretched to 75 seconds? (Bad sign)
      - Does the script tell a story OVER the visuals? (Good sign)
      - Does the script point to or describe the visuals? (Bad sign)

  completion_checker:
    name: "Completion Checker"
    description: "Evaluates end conditions and decides to iterate or complete"
    triggers: ["review.complete"]
    publishes: []
    instructions: |
      ## COMPLETION CHECKER PHASE

      You decide whether we have enough quality ideas or need another round.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`

      2. Count passing ideas:
         ```bash
         passing_count=$(yq eval '.ideas[] | select(.status == "passing") | .id' .ideation/output/ideas.yaml | wc -l)
         echo "Passing ideas: $passing_count"
         ```

      3. Check end conditions in order:

      **Condition 1: Quality threshold met**
      - If >= 3 ideas with status "passing" (avg_score >= 8.0):
        - Update rounds counter in ideas.yaml
        - Close all tasks: `ralph tools task list` and close each
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 2: Max rounds reached**
      - If rounds >= 5 in ideas.yaml:
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 3: Iterate**
      - Otherwise:
        - Increment rounds in ideas.yaml
        - Analyze why ideas failed (check review feedback)
        - Create memory with patterns:
          ```bash
          ralph tools memory add "pattern: [specific pattern from failed ideas]" -t pattern
          ```
        - Publish event to restart:
          ```bash
          ralph emit "images.analyzed" "iterate: round [N], need [M] more passing ideas"
          ```

      ### Don't
      - Do not iterate more than 5 rounds total
      - Do not complete without closing tasks
      - Do not skip pattern analysis
