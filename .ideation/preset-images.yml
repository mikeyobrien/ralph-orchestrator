# Content Ideation with Images Preset
#
# Image-driven ideation pipeline where each idea is connected to visual assets.
# Planner → Image Analyzer → Creators (Trend/Story) → Reviewers (Audience+Brand/Critic)
#
# Usage:
#   1. cp .ideation/templates/avatar/myla.yaml .ideation/input/avatar.yaml
#   2. cp .ideation/templates/late-night-techno.md .ideation/input/prompt.md
#   3. ideate run-with-images ./path/to/images "Generate content ideas"
#
# Output: .ideation/output/ideas.yaml (with image_files field)

event_loop:
  prompt_file: ".ideation/PROMPT.md"
  completion_promise: "IDEATION_COMPLETE"
  max_iterations: 25
  max_runtime_seconds: 3600
  checkpoint_interval: 5
  starting_event: "ideate.start"

cli:
  backend: "claude"

core:
  specs_dir: "./specs/"

tasks:
  enabled: true

memories:
  enabled: true
  inject: auto
  budget: 2000

hats:
  planner:
    name: "Content Planner"
    description: "Analyzes avatar, prompt, and images to create ideation tasks"
    triggers: ["ideate.start"]
    publishes: ["ideate.analyze_images"]
    default_publishes: "ideate.analyze_images"
    instructions: |
      ## PLANNER PHASE

      You are the content strategist. Your job is to understand the avatar's voice,
      the prompt's intent, the available images, and create specific, actionable ideation tasks.

      ### Process

      1. Read the avatar profile: `.ideation/input/avatar.yaml`
         - Note personality, expertise, constraints

      2. Read the prompt: `.ideation/input/prompt.md`
         - Note theme, focus areas, format preferences

      3. Read the images index: `.ideation/input/images-index.md`
         - This lists all available images for content generation

      4. Search for relevant memories about this avatar or theme:
         ```bash
         ralph tools memory search "avatar_name OR theme_keyword"
         ```

      5. Create task for image analysis:
         ```bash
         ralph tools task add "Image Analyzer: Analyze all images and create content themes" -p 1
         ```

      6. Publish event to trigger image analysis:
         ```bash
         ralph emit "ideate.analyze_images" "created image analysis task"
         ```

      ### Don't
      - Do not generate ideas yourself (that's the creators' job)
      - Do not output the completion promise
      - Do not skip reading input files

  image_analyzer:
    name: "Image Analyzer"
    description: "Analyzes images and creates content themes for each image or group"
    triggers: ["ideate.analyze_images"]
    publishes: ["images.analyzed"]
    default_publishes: "images.analyzed"
    instructions: |
      ## IMAGE ANALYZER PHASE

      You analyze the provided images and create content themes that can be paired with them.

      ### Process

      1. Read images index: `.ideation/input/images-index.md`
      2. Read avatar: `.ideation/input/avatar.yaml`
      3. Read prompt: `.ideation/input/prompt.md`

      4. For EACH image in the index:
         - Read the image file (use the full path from the index)
         - Analyze visual content, mood, composition, colors, subjects
         - Identify what content themes this image could support

      5. Create image analysis file: `.ideation/output/image-analysis.yaml`
         ```yaml
         images:
           - file: "path/to/image1.jpg"
             description: "Detailed description of what's in the image"
             mood: [intimate/energetic/reflective/moody/vibrant]
             themes:
               - "Specific content theme this image could support"
               - "Another theme this image works for"
             potential_formats: [monologue/story/tip/reaction]
             duration_fit: "60-90 seconds for this pace"

           - file: "path/to/image2.jpg"
             description: "..."
             mood: [...]
             themes: [...]
             potential_formats: [...]
             duration_fit: "..."
         ```

      6. Create ideation tasks for creators:
         ```bash
         ralph tools task add "Trend Spotter: Generate ideas using image analysis themes" -p 1
         ralph tools task add "Storyteller: Generate narrative ideas using image analysis themes" -p 1
         ```

      7. Publish event:
         ```bash
         ralph emit "images.analyzed" "analyzed [N] images, identified [M] content themes"
         ```

      ### Quality Bar
      - Be specific about visual elements (not just "a person dancing")
      - Connect image mood to content opportunities
      - Think about how visuals enhance storytelling

  trend_spotter:
    name: "Trend Spotter"
    description: "Generates ideas based on cultural relevance paired with images"
    triggers: ["images.analyzed"]
    publishes: ["trend.done"]
    default_publishes: "trend.done"
    instructions: |
      ## TREND SPOTTER PHASE

      You identify culturally relevant angles and pair them with appropriate images.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`
      4. Search memories for patterns about trends:
         ```bash
         ralph tools memory search "trend OR zeitgeist" --tags pattern
         ```

      5. Generate 2-3 content ideas where EACH idea:
         - Is based on current cultural conversations
         - Is paired with 1-3 images from the analysis
         - Uses the image's mood and themes

      6. For EACH idea, create YAML structure:
         ```yaml
         ideas:
           - id: "trend-001-[timestamp]"
             title: "[Punchy, specific title]"
             hook: "[First 5 seconds - what grabs attention]"
             angle: "[The unique perspective or take]"
             rationale: "[Why this works right now]"
             mood: [calm/hype/reflective/intimate/provocative]
             format: [monologue/story/tip/reaction/question]
             duration_seconds: 75
             creator: "trend_spotter"
             image_files:
               - "path/to/image1.jpg"
               - "path/to/image2.jpg"
             image_usage: "[How these images will be used in the video - e.g., 'Image1 as opening shot, Image2 for emphasis at 30s']"
             reviews: []
             avg_score: 0.0
             status: "pending"
         ```

      7. Append ideas to `.ideation/output/ideas.yaml` (create file if missing)
         - If file doesn't exist, create header:
           ```yaml
           run_id: "[timestamp]"
           timestamp: "[ISO datetime]"
           avatar: "[from avatar.yaml]"
           theme: "[from prompt.md]"
           rounds: 1
           ideas: []
           ```
         - Then append your ideas to the `ideas` array

      8. Publish event:
         ```bash
         ralph emit "trend.done" "trend_spotter: generated [N] ideas with images"
         ```

      ### Quality Bar
      - Images must enhance the idea (not just decoration)
      - Explain HOW images will be used (timing, purpose)
      - Match image mood to content mood

  storyteller:
    name: "Storyteller"
    description: "Generates narrative ideas paired with images"
    triggers: ["trend.done"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## STORYTELLER PHASE

      You find personal narratives and pair them with images that enhance emotional resonance.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`
      4. Search memories for storytelling patterns:
         ```bash
         ralph tools memory search "storytelling OR narrative" --tags pattern
         ```

      5. Generate 2-3 content ideas where EACH idea:
         - Tells a personal or emotional story
         - Is paired with 1-3 images that enhance the narrative
         - Uses images to establish mood or illustrate moments

      6. Create ideas with YAML structure including image_files and image_usage:
         - Use id prefix: "story-001-[timestamp]"
         - Set creator: "storyteller"
         - Include image_files array
         - Include image_usage description
         - Focus on narrative arc and emotional beats

      7. Append to `.ideation/output/ideas.yaml`

      8. Publish event:
         ```bash
         ralph emit "ideas.generated" "storyteller: generated [N] ideas with images"
         ```

      ### Quality Bar
      - Images should amplify emotional moments
      - Explain narrative purpose of each image
      - Consider visual flow through the story

  audience_brand_reviewer:
    name: "Audience & Brand Reviewer"
    description: "Scores ideas on audience appeal, brand authenticity, and image fit"
    triggers: ["ideas.generated"]
    publishes: ["review.audience_brand"]
    default_publishes: "review.audience_brand"
    instructions: |
      ## AUDIENCE & BRAND REVIEWER PHASE

      You evaluate ideas from three perspectives: audience appeal, brand authenticity, AND visual coherence.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read all ideas: `.ideation/output/ideas.yaml`
      3. Read image analysis: `.ideation/output/image-analysis.yaml`

      4. For EACH idea, score 1-10 based on combined criteria:

         **Audience Appeal (3 points):**
         - Would I stop scrolling for this? (1.5 points)
         - Does the hook grab me in 2 seconds? (1.5 points)

         **Brand Authenticity (3 points):**
         - Does this fit the avatar's voice? (1.5 points)
         - Is this authentic to the persona? (1.5 points)

         **Visual Coherence (4 points):**
         - Do the images enhance the idea? (2 points)
         - Is image usage purposeful, not decorative? (1 point)
         - Does visual mood match content mood? (1 point)

      5. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "audience_brand"
             score: 7.5
             feedback: "Strong hook. Images work well for opening but transition feels forced. Visual mood slightly off-brand."
         ```

      6. Write updated YAML back to `.ideation/output/ideas.yaml`

      7. Publish event:
         ```bash
         ralph emit "review.audience_brand" "audience_brand: reviewed [N] ideas"
         ```

      ### Scoring Guide
      - 9-10: Exceptional visual storytelling + perfect brand fit
      - 7-8: Strong idea, images enhance it
      - 5-6: Decent but images feel tacked on
      - 3-4: Weak or images detract from idea
      - 1-2: Poor fit or brand violation

  critic_reviewer:
    name: "Critical Reviewer"
    description: "Scores ideas with skepticism, evaluates originality and visual execution"
    triggers: ["review.audience_brand"]
    publishes: ["review.complete"]
    default_publishes: "review.complete"
    instructions: |
      ## CRITICAL REVIEWER PHASE

      You are the ruthless critic who also evaluates visual execution.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`
      2. Read image analysis: `.ideation/output/image-analysis.yaml`

      3. For EACH idea, score 1-10 with extreme skepticism:
         - Is this truly original? (3 points)
         - Is this cringe, derivative, or genuinely fresh? (2 points)
         - Would this actually stop someone scrolling? (2 points)
         - Are images used creatively or predictably? (2 points)
         - Does visual execution elevate the idea? (1 point)

      4. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "critic"
             score: 5.0
             feedback: "Hook uses tired pattern. Images are clichéd (dancing hands, again?). Visual usage description is vague. What makes THIS different from 1000 other posts?"
         ```

      5. Calculate average score for EACH idea:
         - avg_score = (audience_brand + critic) / 2
         - Round to 1 decimal place

      6. Set status for EACH idea:
         - status: "passing" if avg_score >= 8.0
         - status: "failing" if avg_score < 8.0

      7. Write updated YAML back to `.ideation/output/ideas.yaml`

      8. Publish event:
         ```bash
         ralph emit "review.complete" "critic: reviewed [N] ideas, [M] passing"
         ```

      ### Be EXTREMELY Ruthless
      - Call out clichéd image choices (sunset silhouettes, coffee cups, generic hands)
      - Question vague image usage ("backdrop", "visual interest" = lazy)
      - Reward creative, specific visual storytelling
      - Default score: 5-6. Make them earn 8+.

  completion_checker:
    name: "Completion Checker"
    description: "Evaluates end conditions and decides to iterate or complete"
    triggers: ["review.complete"]
    publishes: []
    instructions: |
      ## COMPLETION CHECKER PHASE

      You decide whether we have enough quality ideas or need another round.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`

      2. Count passing ideas:
         ```bash
         passing_count=$(yq eval '.ideas[] | select(.status == "passing") | .id' .ideation/output/ideas.yaml | wc -l)
         echo "Passing ideas: $passing_count"
         ```

      3. Check end conditions in order:

      **Condition 1: Quality threshold met**
      - If >= 3 ideas with status "passing" (avg_score >= 8.0):
        - Update rounds counter in ideas.yaml
        - Close all tasks: `ralph tools task list` and close each
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 2: Max rounds reached**
      - If rounds >= 5 in ideas.yaml:
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 3: Iterate**
      - Otherwise:
        - Increment rounds in ideas.yaml
        - Analyze why ideas failed (check review feedback)
        - Create memory with patterns:
          ```bash
          ralph tools memory add "pattern: [specific pattern from failed ideas]" -t pattern
          ```
        - Publish event to restart:
          ```bash
          ralph emit "images.analyzed" "iterate: round [N], need [M] more passing ideas"
          ```

      ### Don't
      - Do not iterate more than 5 rounds total
      - Do not complete without closing tasks
      - Do not skip pattern analysis
