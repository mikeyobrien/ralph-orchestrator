# Content Ideation Preset (Optimized)
#
# Streamlined 5-hat pipeline for faster iterations while maintaining quality.
# Planner → Creators (Trend/Story) → Reviewers (Audience+Brand/Critic)
#
# Usage:
#   1. cp .ideation/templates/avatar/myla.yaml .ideation/input/avatar.yaml
#   2. cp .ideation/templates/late-night-techno.md .ideation/input/prompt.md
#   3. ralph run -c presets/content-ideation.yml -p "Generate content ideas"
#
# Output: .ideation/output/ideas.yaml

event_loop:
  prompt_file: ".ideation/PROMPT.md"
  completion_promise: "IDEATION_COMPLETE"
  max_iterations: 25
  max_runtime_seconds: 3600
  checkpoint_interval: 5
  starting_event: "ideate.start"

cli:
  backend: "claude"

core:
  specs_dir: "./specs/"

# Tasks track ideation workflow
tasks:
  enabled: true

# Memories accumulate what works across runs
memories:
  enabled: true
  inject: auto
  budget: 2000

hats:
  planner:
    name: "Content Planner"
    description: "Analyzes avatar and prompt to create ideation tasks for creators"
    triggers: ["ideate.start"]
    publishes: ["ideate.create"]
    default_publishes: "ideate.create"
    instructions: |
      ## PLANNER PHASE

      You are the content strategist. Your job is to understand the avatar's voice,
      the prompt's intent, and create specific, actionable ideation tasks.

      ### Process

      1. Read the avatar profile: `.ideation/input/avatar.yaml`
         - Note personality, expertise, constraints

      2. Read the prompt: `.ideation/input/prompt.md`
         - Note theme, focus areas, format preferences

      3. Search for relevant memories about this avatar or theme:
         ```bash
         ralph tools memory search "avatar_name OR theme_keyword"
         ```

      4. Create ideation tasks for each creator hat:
         ```bash
         ralph tools task add "Trend Spotter: Find culturally relevant angles for [theme]" -p 1
         ralph tools task add "Storyteller: Find personal narrative hooks for [theme]" -p 1
         ```

      5. Publish event to trigger creators:
         ```bash
         ralph emit "ideate.create" "created 2 ideation tasks for: [theme]"
         ```

      ### Don't
      - Do not generate ideas yourself (that's the creators' job)
      - Do not output the completion promise
      - Do not skip reading input files

  trend_spotter:
    name: "Trend Spotter"
    description: "Generates ideas based on cultural relevance and current zeitgeist"
    triggers: ["ideate.create"]
    publishes: ["trend.done"]
    default_publishes: "trend.done"
    instructions: |
      ## TREND SPOTTER PHASE

      You identify culturally relevant angles and capitalize on current conversations.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Search memories for patterns about trends:
         ```bash
         ralph tools memory search "trend OR zeitgeist" --tags pattern
         ```

      4. Generate 2-3 content ideas based on:
         - What conversations are happening NOW?
         - What's the zeitgeist in this space?
         - What would stop someone mid-scroll?

      5. For EACH idea, create YAML structure:
         ```yaml
         ideas:
           - id: "trend-001-[timestamp]"
             title: "[Punchy, specific title]"
             hook: "[First 5 seconds - what grabs attention]"
             angle: "[The unique perspective or take]"
             rationale: "[Why this works right now]"
             mood: [calm/hype/reflective/intimate/provocative]
             format: [monologue/story/tip/reaction/question]
             duration_seconds: 75
             creator: "trend_spotter"
             reviews: []
             avg_score: 0.0
             status: "pending"
         ```

      6. Append ideas to `.ideation/output/ideas.yaml` (create file if missing)
         - If file doesn't exist, create header:
           ```yaml
           run_id: "[timestamp]"
           timestamp: "[ISO datetime]"
           avatar: "[from avatar.yaml]"
           theme: "[from prompt.md]"
           rounds: 1
           ideas: []
           ```
         - Then append your ideas to the `ideas` array

      7. Publish event:
         ```bash
         ralph emit "trend.done" "trend_spotter: generated 3 ideas"
         ```

      ### Quality Bar
      - Title: Under 10 words, specific not generic
      - Hook: Must create curiosity in 2 seconds
      - Angle: Must be unique to this moment in time
      - Rationale: Explain the cultural context

  storyteller:
    name: "Storyteller"
    description: "Generates ideas based on narrative and emotional resonance"
    triggers: ["trend.done"]
    publishes: ["ideas.generated"]
    default_publishes: "ideas.generated"
    instructions: |
      ## STORYTELLER PHASE

      You find the personal narratives and emotional moments that create connection.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
      2. Read prompt: `.ideation/input/prompt.md`
      3. Search memories for storytelling patterns:
         ```bash
         ralph tools memory search "storytelling OR narrative" --tags pattern
         ```

      4. Generate 2-3 content ideas based on:
         - What personal experiences resonate?
         - What moments create emotional connection?
         - What stories need to be told?

      5. Create ideas with same YAML structure as trend_spotter:
         - Use id prefix: "story-001-[timestamp]"
         - Set creator: "storyteller"
         - Focus on narrative arc and emotional beats

      6. Append to `.ideation/output/ideas.yaml`

      7. Publish event:
         ```bash
         ralph emit "ideas.generated" "storyteller: generated 3 ideas"
         ```

      ### Quality Bar
      - Title: Should evoke emotion or curiosity
      - Hook: Must establish personal connection immediately
      - Angle: Ground abstract concepts in lived experience
      - Rationale: Explain the emotional resonance

  audience_brand_reviewer:
    name: "Audience & Brand Reviewer"
    description: "Scores ideas on audience appeal and brand authenticity"
    triggers: ["ideas.generated"]
    publishes: ["review.audience_brand"]
    default_publishes: "review.audience_brand"
    instructions: |
      ## AUDIENCE & BRAND REVIEWER PHASE

      You evaluate ideas from two perspectives: target audience appeal AND brand authenticity.

      ### Process

      1. Read avatar: `.ideation/input/avatar.yaml`
         - Note personality, voice, constraints for brand alignment
      2. Read all ideas: `.ideation/output/ideas.yaml`

      3. For EACH idea, score 1-10 based on combined criteria:

         **Audience Appeal (5 points):**
         - Would I stop scrolling for this? (2 points)
         - Does the hook grab me in 2 seconds? (2 points)
         - Is this relevant to me right now? (1 point)

         **Brand Authenticity (5 points):**
         - Does this fit the avatar's voice and tone? (2 points)
         - Is this authentic to the persona? (2 points)
         - Would the avatar actually say this? (1 point)

      4. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "audience_brand"
             score: 7.5
             feedback: "Hook grabs attention but tone feels slightly too hype for [avatar]'s calm style. Strong cultural relevance."
         ```

      5. Write updated YAML back to `.ideation/output/ideas.yaml`

      6. Publish event with count:
         ```bash
         ralph emit "review.audience_brand" "audience_brand: reviewed [N] ideas"
         ```

      ### Scoring Guide (Be Harsh)
      - 9-10: Exceptional. Stops thumbs mid-scroll + perfect brand fit. Rare.
      - 7-8: Strong hook, good alignment, but not extraordinary
      - 5-6: Decent but forgettable. Tone issues or generic angle.
      - 3-4: Weak hook or brand misalignment
      - 1-2: Skip-worthy or brand violation

      Default to 6-7 range. Reserve 8+ for truly outstanding ideas.

  critic_reviewer:
    name: "Critical Reviewer"
    description: "Scores ideas with skepticism, finds weaknesses and clichés"
    triggers: ["review.audience_brand"]
    publishes: ["review.complete"]
    default_publishes: "review.complete"
    instructions: |
      ## CRITICAL REVIEWER PHASE

      You are the ruthless critic. Assume every idea is mediocre until proven exceptional.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`
      2. For EACH idea, score 1-10 with extreme skepticism:
         - Is this truly original? (Not just "slightly different") (4 points)
         - Is this cringe, derivative, or genuinely fresh? (3 points)
         - Would this actually stop someone scrolling? Be honest. (3 points)

      3. Update EACH idea's reviews array:
         ```yaml
         reviews:
           - reviewer: "critic"
             score: 5.0
             feedback: "Hook uses tired pattern ('Everyone talks about X, nobody talks about Y'). Seen this 1000 times. Angle lacks specificity. Why would I care?"
         ```

      4. Calculate average score for EACH idea:
         - avg_score = (audience_brand + critic) / 2
         - Round to 1 decimal place

      5. Set status for EACH idea:
         - status: "passing" if avg_score >= 8.0
         - status: "failing" if avg_score < 8.0

      6. Write updated YAML back to `.ideation/output/ideas.yaml`

      7. Count passing ideas and publish event:
         ```bash
         ralph emit "review.complete" "critic: reviewed [N] ideas, [M] passing (avg >= 8.0)"
         ```

      ### Be EXTREMELY Ruthless
      - Default score: 5-6. Make them earn 7+. Reserve 8+ for rare brilliance.
      - Call out ALL generic language ("magic", "journey", "elevate", "authentic", "game-changer")
      - Flag overused patterns ("Everyone says X, but Y", "The truth about Z", "What nobody tells you")
      - Reject vague hooks that could apply to anything
      - Question every rationale: "So what? Why does this matter RIGHT NOW?"
      - If you've seen the angle before, say so explicitly

  completion_checker:
    name: "Completion Checker"
    description: "Evaluates end conditions and decides to iterate or complete"
    triggers: ["review.complete"]
    publishes: []
    instructions: |
      ## COMPLETION CHECKER PHASE

      You decide whether we have enough quality ideas or need another round.

      ### Process

      1. Read all ideas: `.ideation/output/ideas.yaml`

      2. Count passing ideas:
         ```bash
         passing_count=$(yq eval '.ideas[] | select(.status == "passing") | .id' .ideation/output/ideas.yaml | wc -l)
         echo "Passing ideas: $passing_count"
         ```

      3. Check end conditions in order:

      **Condition 1: Quality threshold met**
      - If >= 3 ideas with status "passing" (avg_score >= 8.0):
        - Update rounds counter in ideas.yaml
        - Close all tasks: `ralph tools task list` and close each
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 2: Max rounds reached**
      - If rounds >= 5 in ideas.yaml:
        - Output completion promise: `IDEATION_COMPLETE`
        - DONE

      **Condition 3: Iterate**
      - Otherwise:
        - Increment rounds in ideas.yaml
        - Analyze why ideas failed (check review feedback)
        - Create memory with patterns:
          ```bash
          ralph tools memory add "pattern: [specific pattern from failed ideas]" -t pattern
          ```
        - Publish event to restart:
          ```bash
          ralph emit "ideate.create" "iterate: round [N], need [M] more passing ideas"
          ```

      ### Don't
      - Do not iterate more than 5 rounds total
      - Do not complete without closing tasks
      - Do not skip pattern analysis
